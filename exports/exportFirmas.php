<?php
session_start();
require_once '../models/conection.php';
require_once 'indicadoresgaceta.php';

if (!(isset($_SESSION) && isset($_SESSION['sistema']) && $_SESSION['sistema'] == "pbrm")) {
    header("Location: ../index.php");
}


$areasTeso = array(
array("103A00100","010502060402"),
array("103A00101","010502060401"),
array("103A00101","010502060402"),
array("103A00101","010803010103"),
array("103A00112","020404010102"),
array("103A00150","020402010102"),
array("103A00159","010701010102"),
array("103A01100","010803010103"),
array("103A01100","010805010103"),
array("103A01101","010805010103"),
array("103A01103","010502060201"),
array("103A01103","010803010103"),
array("103A01103","010805010103"),
array("103A01112","010803010103"),
array("103A02102","010204010101"),
array("103A02102","010204010102"),
array("103B01101","010305010105"),
array("103C01C01","010309020101"),
array("103C02C02","010309020101"),
array("103C03C03","010309020101"),
array("103C04C04","010309020101"),
array("103C05C05","010309020101"),
array("103C06C06","010309020101"),
array("103C07C07","010309020101"),
array("103C08C08","010309020101"),
array("103C09C09","010309020101"),
array("103D00D00","010309020101"),
array("103D00100","010301010101"),
array("103D00100","010303010101"),
array("103D00100","010502050107"),
array("103D00100","010803010103"),
array("103D00101","010309020101"),
array("103D00114","010502060301"),
array("103D00148","010301010101"),
array("103D00155","010305010105"),
array("103E00100","010502060101"),
array("103E00100","010502060201"),
array("103E00100","010502060301"),
array("103E00100","010502060401"),
array("103E00101","010502060201"),
array("103E00101","010502060301"),
array("103E00120","010502060101"),
array("103E00120","010502060102"),
array("103E00121","010502060201"),
array("103E00121","010502060301"),
array("103E02E02","010805010103"),
array("103E02100","010802010201"),
array("103E02100","010805010103"),
array("103E02101","010805010103"),
array("103E02121","010805010103"),
array("103E03101","010502060201"),
array("103E03121","010502060201"),
array("103E03131","010502060201"),
array("103F00F00","010308010202"),
array("103F00F00","020201010502"),
array("103F00F00","020201010503"),
array("103F00F01","010308010201"),
array("103F00F01","010308010202"),
array("103F00100","010308010202"),
array("103F00100","010308010302"),
array("103F00100","010502060201"),
array("103F00100","020201010202"),
array("103F00101","020201010503"),
array("103F00107","010308010201"),
array("103F00107","010308010202"),
array("103F00123","010305010105"),
array("103F00123","010308010201"),
array("103F00123","010308010202"),
array("103F00123","010308010302"),
array("103F00123","010502050109"),
array("103F00123","020201010303"),
array("103F00124","010304010102"),
array("103F00124","010502050109"),
array("103F00124","010502060201"),
array("103F00124","020201010202"),
array("103F00124","020201010302"),
array("103F00124","020201010502"),
array("103F00124","020201010503"),
array("103F01F01","010308010201"),
array("103F01107","010308010201"),
array("103F01107","010308010202"),
array("103F01123","010308010201"),
array("103G00100","020104010302"),
array("103G00129","020301010203"),
array("103G00160","020104010301"),
array("103G00160","020104010302"),
array("103H00H00","020101010102"),
array("103H00100","020101010102"),
array("103H00100","020204010201"),
array("103H00100","020206010301"),
array("103H00101","020101010102"),
array("103H00101","020206010301"),
array("103H00120","020206010301"),
array("103H00121","020206010301"),
array("103H00125","020101010102"),
array("103H00126","020101010102"),
array("103H00127","020204010201"),
array("103H00128","020206010301"),
array("103H00145","020206010302"),
array("103I01100","020202010101"),
array("103I01100","020202010102"),
array("103I01100","020404010102"),
array("103I01100","020605010102"),
array("103I01101","020202010101"),
array("103I01101","020605010102"),
array("103I01110","020202010101"),
array("103I01112","010301010201"),
array("103I01112","020404010102"),
array("103I01137","020202010101"),
array("103I01139","020202010102"),
array("103I01139","020605010102"),
array("103I01143","020608060202"),
array("103I01166","020202010102"),
array("103I02153","020302010101"),
array("103J00100","020206010101"),
array("103J00101","020206010101"),
array("103J00112","010304010102"),
array("103J00132","020206010101"),
array("103J00137","020206010101"),
array("103J00144","010701010101"),
array("103J00144","020206010101"),
array("103J00147","020206010101"),
array("103K00100","010304010101"),
array("103K00100","010304020201"),
array("103K00100","010304020204"),
array("103K00101","010304020201"),
array("103K00104","010304020201"),
array("103K00134","010304010101"),
array("103K00135","010304010102"),
array("103K00136","010304010101"),
array("103K00136","010304020201"),
array("103K00138","010304020201"),
array("103K00162","010304020204"),
array("103L00100","010502020101"),
array("103L00100","010502020401"),
array("103L00100","010801020201"),
array("103L00101","010502020101"),
array("103L00101","010502060401"),
array("103L00101","010801020201"),
array("103L00115","010502020101"),
array("103L00116","010502050203"),
array("103L00117","010502050109"),
array("103L00118","010801020201"),
array("103L00119","010502050203"),
array("103M00100","010305010105"),
array("103M00101","010305010105"),
array("103M00108","010309030101"),
array("103M00109","010801010302"),
array("103M00143","020608060102"),
array("103M00155","010305010105"),
array("103M00164","010309030101"),
array("103N00100","010502050107"),
array("103N00100","030903010202"),
array("103N00101","030402010102"),
array("103N00101","030903010202"),
array("103N00131","030402010102"),
array("103N00131","030402010103"),
array("103N00132","030402010102"),
array("103N00132","030402010103"),
array("103N00133","030903010202"),
array("103N00140","030102010202"),
array("103N00149","030701010101"),
array("103N00149","030701010102"),
array("103N01130","030201020201"),
array("103O00100","020402010101"),
array("103O00100","020402010102"),
array("103O00100","020501010106"),
array("103O00100","020502010105"),
array("103O00101","010303010101"),
array("103O00101","020402010102"),
array("103O00101","020501010106"),
array("103O00101","020503010105"),
array("103O00110","020402010102"),
array("103O00113","020402010102"),
array("103O00114","010303010101"),
array("103O00141","020501010106"),
array("103O00141","020503010105"),
array("103O00141","020505010101"),
array("103O00150","020402010101"),
array("103O00150","020402010102"),
array("103P00100","010304010102"),
array("103P00101","010304010102"),
array("103P00103","010803010103"),
array("103Q00100","010502060201"),
array("103Q00100","010701010101"),
array("103Q00100","010701010107"),
array("103Q00100","010702010303"),
array("103Q00100","010802010202"),
array("103Q00101","010701010101"),
array("103Q00101","010701010107"),
array("103Q00101","010702010303"),
array("103Q00103","010701010101"),
array("103Q00104","010701010101"),
array("103Q00104","010701010107"),
array("103Q00104","010702010303"),
array("103Q00120","010502060101"),
array("103Q00120","010502060201"),
array("103Q00120","010701010101"),
array("103Q00120","010701010102"),
array("103Q00120","010701010103"),
array("103Q00142","010701010101"),
array("103Q00154","010701010203"),
array("103Q00154","010802010202"),
array("103Q00155","010701010101"),
array("103Q00158","010701010203"),
array("103Q00162","010701010101"),
array("103S00S00","010401010103"),
array("103S00S00","010502050109"),
array("103S00S00","010502060402"),
array("103S00100","010305010105"),
array("103S00100","010502050109"),
array("103S00100","010804010101"),
array("103S00101","010804010101"),
array("103S00122","010804010101"),
array("103S00137","010502060401"),
array("103S00137","010502060402"),
array("103S00165","010502050107"),
array("103T00100","010702010201"),
array("103T00101","010702010201"),
array("103T00105","010702010101"),
array("103T00105","010702010201"),
array("103T00106","010702010303"),
array("103V00152","010305010105"),
array("103V00152","020608050101"),
array("103V00152","020608050102"),
array("103V00152","020608050104"),
);


$sentencia = "SELECT * FROM ante_areas ar
LEFT JOIN dependencias_generales dg ON dg.id_dependencia = ar.id_dependencia
LEFT JOIN dependencias_auxiliares da ON da.id_dependencia_auxiliar = ar.id_dependencia_aux
LEFT JOIN proyectos py ON py.id_proyecto = ar.id_proyecto
";
$result = $con->query($sentencia);
$areas = $result->fetchAll(PDO::FETCH_ASSOC);

function buscaFirma($con, $dep_gen, $dep_aux, $proy, $areas){

    print($dep_gen. " " . $dep_aux. " " . $proy);




    foreach($areas as $ar){
        print '<pre>';
        var_dump($ar);
        if($ar['clave_dependencia'] == $dep_gen && $ar['clave_dependencia_auxiliar'] == $dep_aux && $ar['codigo_proyecto'] == $proy){
            $id_area = $ar['id_area'];
            $area = $ar;
        }
    }
    
    die();
    $sentencia = "SELECT * FROM titulares WHERE id_area = $id_area";
    $stm = $con->query($sentencia);
    $titular = $stm->fetch(PDO::FETCH_ASSOC);
    
    if($area && $titular){
        return array ($titular, $area) ;
    }else{
        return false;
    }
}


foreach($areasTeso as $a){
    $depGen = substr($a[0], 3, 3); 
    $depAux = substr($a[0], 6, 3); 
    $proyecto = $a[1];

    $result = buscaFirma($con, $depGen, $depAux, $proyecto, $areas);


    if($result){
        print $result[1]['nombre_area'] . "|" . $result[0]['nombre'] . " " . $result[0]['apellidos'] . "|" . $result[0]['cargo'];
    }else{
        print"/////////////////////////////////";
    }
    print "<br>";
}





?>