<?php 
require_once '../models/conection.php';
$sistema =array(
"A00100010502060402",
"A00101010502060401",
"A00101010502060402",
"A00101010803010103",
"A00112020404010102",
"A00150020402010102",
"A00159010701010102",
"A01100010803010103",
"A01100010805010103",
"A01101010805010103",
"A01103010502060201",
"A01103010803010103",
"A01103010805010103",
"A01112010803010103",
"A02102010204010101",
"A02102010204010102",
"B01101010305010105",
"C01C01010309020101",
"C02C02010309020101",
"C03C03010309020101",
"C04C04010309020101",
"C05C05010309020101",
"C06C06010309020101",
"C07C07010309020101",
"C08C08010309020101",
"C09C09010309020101",
"D00D00010309020101",
"D00100010301010101",
"D00100010303010101",
"D00100010502050107",
"D00100010803010103",
"D00101010309020101",
"D00114010502060301",
"D00148010301010101",
"D00155010305010105",
"E00100010502060101",
"E00100010502060201",
"E00100010502060301",
"E00100010502060401",
"E00101010502060201",
"E00101010502060301",
"E00120010502060101",
"E00120010502060102",
"E00121010502060201",
"E00121010502060301",
"E02E02010805010103",
"E02100010802010201",
"E02100010805010103",
"E02101010805010103",
"E02121010805010103",
"E03101010502060201",
"E03121010502060201",
"E03131010502060201",
"F00F00010308010202",
"F00F00020201010502",
"F00F00020201010503",
"F00F01010308010201",
"F00F01010308010202",
"F00100010308010202",
"F00100010308010302",
"F00100010502060201",
"F00101020201010503",
"F00107010308010201",
"F00107010308010202",
"F00123010305010105",
"F00123010308010201",
"F00123010308010202",
"F00123010308010302",
"F00123010502050109",
"F00123020201010303",
"F00124010304010102",
"F00124010502050109",
"F00124010502060201",
"F00124020201010202",
"F00124020201010302",
"F00124020201010502",
"F00124020201010503",
"F01F01010308010201",
"F01107010308010201",
"F01107010308010202",
"F01123010308010201",
"G00100020104010302",
"G00129020301010203",
"G00160020104010301",
"G00160020104010302",
"H00H00020101010102",
"H00100020101010102",
"H00100020204010201",
"H00100020206010301",
"H00101020101010102",
"H00101020206010301",
"H00120020206010301",
"H00121020206010301",
"H00125020101010102",
"H00126020101010102",
"H00127020204010201",
"H00128020206010301",
"H00145020206010302",
"I01100020202010101",
"I01100020202010102",
"I01100020404010102",
"I01100020605010102",
"I01101020202010101",
"I01101020605010102",
"I01110020202010101",
"I01112010301010201",
"I01112020404010102",
"I01137020202010101",
"I01139020202010102",
"I01139020605010102",
"I01143020608060202",
"I01166020202010102",
"I02153020302010101",
"J00100020206010101",
"J00101020206010101",
"J00112010304010102",
"J00132020206010101",
"J00137020206010101",
"J00144010701010101",
"J00144020206010101",
"J00147020206010101",
"K00100010304010101",
"K00100010304020201",
"K00100010304020204",
"K00101010304020201",
"K00104010304020201",
"K00134010304010101",
"K00135010304010102",
"K00136010304010101",
"K00136010304020201",
"K00138010304020201",
"K00162010304020204",
"L00100010502020101",
"L00100010502020401",
"L00100010801020201",
"L00101010502020101",
"L00101010502060401",
"L00101010801020201",
"L00115010502020101",
"L00116010502050203",
"L00117010502050109",
"L00118010801020201",
"L00119010502050203",
"M00100010305010105",
"M00101010305010105",
"M00108010309030101",
"M00109010801010302",
"M00143020608060102",
"M00155010305010105",
"M00164010309030101",
"N00100010502050107",
"N00100030903010202",
"N00101030402010102",
"N00101030903010202",
"N00131030402010102",
"N00131030402010103",
"N00132030402010102",
"N00132030402010103",
"N00133030903010202",
"N00140030102010202",
"N00149030701010101",
"N00149030701010102",
"N01130030201020201",
"O00100020402010101",
"O00100020402010102",
"O00100020501010106",
"O00100020502010105",
"O00101010303010101",
"O00101020402010102",
"O00101020501010106",
"O00101020503010105",
"O00110020402010102",
"O00113020402010102",
"O00114010303010101",
"O00141020501010106",
"O00141020503010105",
"O00141020505010101",
"O00150020402010101",
"O00150020402010102",
"P00100010304010102",
"P00101010304010102",
"P00103010803010103",
"Q00100010502060201",
"Q00100010701010101",
"Q00100010701010107",
"Q00100010702010303",
"Q00100010802010202",
"Q00101010701010101",
"Q00101010701010107",
"Q00101010702010303",
"Q00103010701010101",
"Q00104010701010101",
"Q00104010701010107",
"Q00104010702010303",
"Q00120010502060101",
"Q00120010502060201",
"Q00120010701010101",
"Q00120010701010102",
"Q00120010701010103",
"Q00142010701010101",
"Q00154010701010203",
"Q00154010802010202",
"Q00155010701010101",
"Q00158010701010203",
"Q00162010701010101",
"S00S00010401010103",
"S00S00010502050109",
"S00S00010502060402",
"S00100010305010105",
"S00100010502050109",
"S00100010804010101",
"S00101010804010101",
"S00122010804010101",
"S00137010502060401",
"S00137010502060402",
"S00165010502050107",
"T00100010702010201",
"T00101010702010201",
"T00105010702010101",
"T00105010702010201",
"T00106010702010303",
"V00152010305010105",
"V00152020608050101",
"V00152020608050102",
"V00152020608050104",
);

mb_internal_encoding('UTF-8');


$sentencia2 = "SELECT * FROM titulares t
JOIN areas a ON a.id_area = t.id_area
LEFT JOIN dependencias dp ON dp.id_dependencia = a.id_dependencia
LEFT JOIN dependencias_generales dg ON dg.id_dependencia = a.id_dependencia_general
LEFT JOIN dependencias_auxiliares da ON da.id_dependencia_auxiliar = a.id_dependencia_aux
LEFT JOIN proyectos p ON p.id_proyecto = a.id_proyecto
";
$stm2 = $con->query($sentencia2);
$titulares = $stm2->fetchAll(PDO::FETCH_ASSOC);


function nombreTitular($con, $id_area){
    $sentencia2 = " SELECT * FROM titulares t 
    WHERE id_dependencia = (SELECT id_dependencia FROM areas WHERE id_area = $id_area)
    ";
    $stm2 = $con->query($sentencia2);
    $t = $stm2->fetch(PDO::FETCH_ASSOC);
    return mb_strtoupper($t['nombre']) . " " . mb_strtoupper($t['apellidos']) . "|" . mb_strtoupper($t['cargo']);
}

foreach($sistema as $s){
    $encontrado = 1;
    foreach($titulares as $t){
        $clave = $t['clave_dependencia'] . $t['clave_dependencia_auxiliar'] . $t['codigo_proyecto'];
        if($clave == $s){
            $nombre_dependencia = nombreTitular($con, $t['id_area']);
            $encontrado = $s . "|" . 
            $t['nombre_dependencia'] . "|" . 
            $t['nombre_area'] . "|" . 
            mb_strtoupper($t['nombre']) . " " . 
            mb_strtoupper($t['apellidos']) . "|" . 
            mb_strtoupper($t['cargo']) . "|" . 
            $nombre_dependencia
            ;
        }
    }
    if($encontrado == 1){
        print "///////" . $s . "<br>";
    }else{
        print $encontrado . "<br>";
    }
}